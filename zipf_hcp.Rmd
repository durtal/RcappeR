---
title: "zipf_hcp"
---
```{r echo=FALSE, warning=FALSE, message=FALSE}
library(RcappeR)
```

Assess the performance (ie. handicap) of a winner of a race using race standardisation; which uses the performances of runners in a different, but similar, race.  This function calls [zipf_race](zipf_race.html), and uses many races to handicap the winner of a single race.  See the [Handicapping using zipf_race](handicap_with_zipf_race.html) vignette for a detailed explanation of the use of Zipfs Law, and also [Handicapping using zipf_hcp](handicap_with_zipf_hcp.html) to see **zipf\_hcp** in use.

### Usage
```{r eval=FALSE}
zipf_hcp(race, past_races, race_id, btn_var, rating = NULL, results = "detail", .progress = "none")
```

### Arguments

param | details
------|-------
race | dataframe of a race to handicap
past\_races | dataframe of past races to be used to handicap **race**
race\_id | name of variable to split **past\_races** up by so each split is one race
btn\_var | name of variable in **race** that contains the margins (in lbs) between the horses
rating | name of ratings variable (if applicable) in race\_2
results | default "detail", determines the output, other option is "simple", which will return the mean rating of all possible ratings
.progress | **plyr**'s progress bar, default is "none", options inc. "text", "time", "tk" or "win"

### Details

The **past\_races** dataframe is split according to **race\_id**, so each split should be a small dataframe of a single race.  For each of these single race dataframes, they are used as the **race\_2** parameter in [zipf_race](zipf_race.html), while the race being handicapped is used as the **race** parameter.  

If _simple_ is entered into the **results** parameter then a single rating, the mean of all possible ratings, is returned.  If the default of _detail_ is left, then a list is returned containing:

* **n\_races** the number of unique races used to handicap **race**
* **mean\_rtg** mean rating for **race** (this is the value returned when _simple_ is entered in **results**)
* **summary** summary statistics of ratings returned
* **ratings** dataframe of ratings (with variables _race\_id_ and _zipf\_rtg_)

An article by Simon Rowlands explaining his use of Zipfs Law and race standardisation can be found [here](https://betting.betfair.com/horse-racing/bloggers/simon-rowlands/simon-rowlands-on-handicapping-060710.html)
